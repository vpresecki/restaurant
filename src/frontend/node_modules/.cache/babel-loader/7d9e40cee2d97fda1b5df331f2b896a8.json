{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\prese\\\\projects\\\\restaurant\\\\src\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n    _s = $RefreshSig$();\n\nimport { createContext, useReducer } from 'react';\nimport HttpRequest from '../utils/HttpRequest';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\n\nconst authReducer = (state, action) => {\n  switch (action.type) {\n    case 'SIGN_IN_SUCCESS':\n      const {\n        access_token,\n        refresh_token\n      } = action.payload;\n      localStorage.setItem('access_token', access_token);\n      localStorage.setItem('refresh_token', refresh_token);\n      return { ...state,\n        ...action.payload,\n        isAuthenticated: true,\n        error: null\n      };\n\n    case 'USER_EXISTS':\n      {\n        localStorage.setItem('access_token', action.paylod.access_token);\n        return { ...state,\n          access_token: action.payload.access_token,\n          isAuthenticated: true\n        };\n      }\n\n    case 'REGISTER_SUCCESS':\n      return state;\n\n    case 'LOGOUT':\n      localStorage.clear();\n      return { ...state,\n        refresh_token: null,\n        access_token: null,\n        isAuthenticated: false,\n        error: null\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport function AuthProvider(_ref) {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(authReducer, {\n    access_token: null,\n    refresh_token: null,\n    isAuthenticated: false,\n    error: null\n  });\n\n  const register = async user => {\n    const req = await fetch('/api/v1/restaurant/user/save', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(user)\n    });\n\n    if (req.ok) {\n      const data = await req.json();\n      dispatch({\n        type: 'REGISTER_SUCCESS',\n        payload: data\n      });\n    }\n  };\n\n  const loadUser = async () => {\n    if (localStorage.getItem('refresh_token')) {\n      const data = await HttpRequest.GET('/api/v1/restaurant/auth', localStorage.getItem('refresh_token'));\n      console.log('DATA' + JSON.stringify(data));\n      dispatch({\n        type: 'USER_EXISTS',\n        payload: data\n      });\n    }\n  };\n\n  const signIn = async user => {\n    const req = await fetch('/login', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      body: new URLSearchParams({\n        email: user.email,\n        password: user.password\n      })\n    });\n\n    if (req.ok) {\n      const data = await req.json();\n      dispatch({\n        type: 'SIGN_IN_SUCCESS',\n        payload: data\n      });\n    }\n  };\n\n  const logout = () => {\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: { ...state,\n      register,\n      loadUser,\n      signIn,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AuthProvider, \"YfWEU8Fcgwh82plM0n/D0ipwtDI=\");\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/prese/projects/restaurant/src/frontend/src/context/AuthContext.js"],"names":["createContext","useReducer","HttpRequest","AuthContext","authReducer","state","action","type","access_token","refresh_token","payload","localStorage","setItem","isAuthenticated","error","paylod","clear","AuthProvider","children","dispatch","register","user","req","fetch","method","headers","body","JSON","stringify","ok","data","json","loadUser","getItem","GET","console","log","signIn","URLSearchParams","email","password","logout"],"mappings":"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","sourcesContent":["import { createContext, useReducer } from 'react';\r\nimport HttpRequest from '../utils/HttpRequest';\r\n\r\nexport const AuthContext = createContext();\r\nconst authReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'SIGN_IN_SUCCESS':\r\n      const { access_token, refresh_token } = action.payload;\r\n      localStorage.setItem('access_token', access_token);\r\n      localStorage.setItem('refresh_token', refresh_token);\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n        isAuthenticated: true,\r\n        error: null,\r\n      };\r\n    case 'USER_EXISTS': {\r\n      localStorage.setItem('access_token', action.paylod.access_token);\r\n      return {\r\n        ...state,\r\n        access_token: action.payload.access_token,\r\n        isAuthenticated: true,\r\n      };\r\n    }\r\n    case 'REGISTER_SUCCESS':\r\n      return state;\r\n    case 'LOGOUT':\r\n      localStorage.clear();\r\n      return {\r\n        ...state,\r\n        refresh_token: null,\r\n        access_token: null,\r\n        isAuthenticated: false,\r\n        error: null,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [state, dispatch] = useReducer(authReducer, {\r\n    access_token: null,\r\n    refresh_token: null,\r\n    isAuthenticated: false,\r\n    error: null,\r\n  });\r\n\r\n  const register = async (user) => {\r\n    const req = await fetch('/api/v1/restaurant/user/save', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(user),\r\n    });\r\n\r\n    if (req.ok) {\r\n      const data = await req.json();\r\n      dispatch({\r\n        type: 'REGISTER_SUCCESS',\r\n        payload: data,\r\n      });\r\n    }\r\n  };\r\n\r\n  const loadUser = async () => {\r\n    if (localStorage.getItem('refresh_token')) {\r\n      const data = await HttpRequest.GET(\r\n        '/api/v1/restaurant/auth',\r\n        localStorage.getItem('refresh_token')\r\n      );\r\n      console.log('DATA' + JSON.stringify(data));\r\n      dispatch({ type: 'USER_EXISTS', payload: data });\r\n    }\r\n  };\r\n\r\n  const signIn = async (user) => {\r\n    const req = await fetch('/login', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: new URLSearchParams({\r\n        email: user.email,\r\n        password: user.password,\r\n      }),\r\n    });\r\n\r\n    if (req.ok) {\r\n      const data = await req.json();\r\n      dispatch({\r\n        type: 'SIGN_IN_SUCCESS',\r\n        payload: data,\r\n      });\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    dispatch({ type: 'LOGOUT' });\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{ ...state, register, loadUser, signIn, logout }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}